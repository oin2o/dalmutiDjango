<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <title>Liar Game</title>
    <style>
        table{
            width: 95%;
        }
        .td6{
            font-size: 0.67em;
            margin-left: 0;
            margin-right: 0;
        }
        .td6c{
            text-align:center;
            font-size: 0.67em;
            margin-left: 0;
            margin-right: 0;
        }
        .tdh6{
            font-size: 0.67em;
            margin-left: 0;
            margin-right: 0;
            font-weight: bold;
        }
        .tdh6c{
            text-align:center;
            font-size: 0.67em;
            margin-left: 0;
            margin-right: 0;
            font-weight: bold;
        }
    </style>
    <script type="text/javascript">
    // í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ì›¹ì†Œì¼“ í†µì‹ ì„ ê°€ëŠ¥í•˜ë„ë¡ ì—°ê²°ì‹œì¼œì£¼ëŠ” ë¶€ë¶„ì´ë‹¤.
    // router.pyì—ì„œì˜ urlê³¼ ì¼ì¹˜í•˜ë„ë¡ í•´ ì£¼ì–´ì•¼í•œë‹¤.
    var web_socket = new WebSocket('ws://' + window.location.host + '/liar/' + '{{ gamer.game.gamecode }}' + '/' + '{{ gamer.user.username }}');

    // onmessageëŠ” counsumersì—ì„œ ë³´ë‚´ëŠ” ë©”ì„¸ì§€ë¥¼ ë°›ëŠ” ë¶€ë¶„ì´ë‹¤.
    web_socket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];

        if (message == 'refresh') {
            setTimeout(function(){
                document.location.href = "{% url 'liar:game' gamer.game.gamecode gamer.user.username %}";
            }, 500);
        }
    };

    function readygame() {
        id_action.value = "readygame";
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function viewgame() {
        id_action.value = "viewgame";
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function startgame() {
        id_action.value = "startgame";
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function votegame() {
        swal("ë°œì–¸ì„ ì¢…ë£Œí•˜ê³  ë¼ì´ì–´ë¥¼ ê²€ê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", {
            dangerMode: true,
            buttons: ["ì·¨ì†Œ", "íˆ¬í‘œ"],
        }).then((isConfirm) => {
            if(isConfirm) {
                id_action.value = "votegame";
                document.forms['gameform'].submit();

                web_socket.send(JSON.stringify({
                    'message': 'refresh'
                }));
            } else {
                swal("ë°œì–¸ì„ ê³„ì†í•©ë‹ˆë‹¤.");
            }
        });
    }

    function resultgame() {
        id_action.value = "resultgame";
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function endgame() {
        id_action.value = "endgame";
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function gamecategory(categoryname) {
        id_action.value = "gamecategory";
        id_categoryname.value = categoryname;
        document.forms['gameform'].submit();

        web_socket.send(JSON.stringify({
            'message': 'refresh'
        }));
    }

    function trickster(tricksterYn) {
        let btn_text = "ì¶”ê°€";
        let danger_mode = false;
        if(tricksterYn == "True") {
            btn_text = "ì œì™¸";
            danger_mode = true;
        }
        swal("ë‚˜ëŠ” ë‚˜ëŠ” ì‚¬ê¸°ê¾¼~ğŸ¶", "ì†Œì†: ë¼ì´ì–´\níŠ¹ìˆ˜: ì œì‹œì–´ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\n\nëª©í‘œ\n1. ë¼ì´ì–´ë¥¼ ë„ì™€ì£¼ì„¸ìš”.\n2. ì‹œë¯¼ì—ê²Œ ì •ì²´ë¥¼ ë“¤í‚¤ì§€ ë§ˆì„¸ìš”.", {
            dangerMode: danger_mode,
            buttons: ["ì·¨ì†Œ", btn_text],
        }).then((isConfirm) => {
            if(isConfirm) {
                id_action.value = "trickster";
                document.forms['gameform'].submit();

                web_socket.send(JSON.stringify({
                    'message': 'refresh'
                }));
            }
        });
    }

    function whistleblower(whistleblowerYn) {
        let btn_text = "ì¶”ê°€";
        let danger_mode = false;
        if(whistleblowerYn == "True") {
            btn_text = "ì œì™¸";
            danger_mode = true;
        }
        swal("ë¼ì´ì–´ê°€ ëˆ„êµ¬ëƒë©´? ì‰¿~ğŸ¤«", "ì†Œì†: ì‹œë¯¼\níŠ¹ìˆ˜: ë¼ì´ì–´ì™€ ì œì‹œì–´ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\n\nëª©í‘œ\n1. ë¼ì´ì–´ì™€ ì‚¬ê¸°ê¾¼ì„ ì°¾ìœ¼ì„¸ìš”.\n2. ë¼ì´ì–´ì—ê²Œ ì •ì²´ë¥¼ ë“¤í‚¤ì§€ ë§ˆì„¸ìš”.", {
            dangerMode: danger_mode,
            buttons: ["ì·¨ì†Œ", btn_text],
        }).then((isConfirm) => {
            if(isConfirm) {
                id_action.value = "whistleblower";
                document.forms['gameform'].submit();

                web_socket.send(JSON.stringify({
                    'message': 'refresh'
                }));
            }
        });

    }

    function descjob(job) {
        if(job == 'citizen') {
            swal("ë‚˜ ì§„ì§œ ì‹œë¯¼ì´ë¼ê³ ~â˜ ", "ì†Œì†: ì‹œë¯¼\níŠ¹ìˆ˜: ì œì‹œì–´ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\n\nëª©í‘œ\n1. ë¼ì´ì–´ì™€ ì‚¬ê¸°ê¾¼ì„ ì°¾ìœ¼ì„¸ìš”.\n2. ë‚´ë¶€ê³ ë°œì(ë°°ì‹ ì)ë¥¼ ë³´í˜¸í•˜ì„¸ìš”.", {
                buttons: false,
                timer: 2000,
            });
        } else if(job == 'liar') {
            swal("I am a Liar~ğŸ‘»", "ì†Œì†: ë¼ì´ì–´\n\nëª©í‘œ\n1. ì œì‹œì–´ë¥¼ ìœ ì¶”í•˜ì„¸ìš”.\n2. ë°°ì‹ ì(ë‚´ë¶€ê³ ë°œì)ë¥¼ ì°¾ìœ¼ì„¸ìš”.", {
                buttons: false,
                timer: 2000,
            });
        } else if(job == 'trickster') {
            swal("ë‚˜ëŠ” ë‚˜ëŠ” ì‚¬ê¸°ê¾¼~ğŸ¶", "ì†Œì†: ë¼ì´ì–´\níŠ¹ìˆ˜: ì œì‹œì–´ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\n\nëª©í‘œ\n1. ë¼ì´ì–´ë¥¼ ë„ì™€ì£¼ì„¸ìš”.\n2. ì‹œë¯¼ì—ê²Œ ì •ì²´ë¥¼ ë“¤í‚¤ì§€ ë§ˆì„¸ìš”.", {
                buttons: false,
                timer: 2000,
            });
        } else if(job == 'whistleblower') {
            swal("ë¼ì´ì–´ê°€ ëˆ„êµ¬ëƒë©´? ì‰¿~ğŸ¤«", "ì†Œì†: ì‹œë¯¼\níŠ¹ìˆ˜: ë¼ì´ì–´ì™€ ì œì‹œì–´ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\n\nëª©í‘œ\n1. ë¼ì´ì–´ì™€ ì‚¬ê¸°ê¾¼ì„ ì°¾ìœ¼ì„¸ìš”.\n2. ë¼ì´ì–´ì—ê²Œ ì •ì²´ë¥¼ ë“¤í‚¤ì§€ ë§ˆì„¸ìš”.", {
                buttons: false,
                timer: 2000,
            });
        }
    }
    </script>
</head>
<body>
{% include "./menu.html" %}
{% load static %}
{% load liar_tags %}
<form name="gameform" action="{% url 'liar:game' gamer.game.gamecode gamer.user.username %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="action" id="id_action"/>
    <input type="hidden" name="categoryname" id="id_categoryname"/>
</form>
<div id="play_msg" style="text-align:center;">
    {% if gamer.game.ingameCd == 0 %}
    <p class="text-warning">ëŒ€ê¸° ì¤‘ì¸ í”Œë ˆì´ì–´ë“¤ì€ ì°¸ê°€ í˜¹ì€ ê´€ì „ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
    {% elif gamer.game.ingameCd == 1 %}
    <p class="text-warning">í”Œë ˆì´ì–´ë“¤ì€ ì œì‹œì–´ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
    {% elif gamer.game.ingameCd == 2 %}
    <p class="text-warning">ì œì‹œì–´ì— ë”°ë¼ ë°œì–¸ì„ í•´ì£¼ì„¸ìš”.</p>
    {% elif gamer.game.ingameCd == 3 %}
    <p class="text-warning">ì˜ì‹¬ê°€ëŠ” í”Œë ˆì´ì–´ì—ê²Œ íˆ¬í‘œí•˜ì„¸ìš”.</p>
    {% elif gamer.game.ingameCd == 4 %}
    <p class="text-warning">ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
    {% endif %}
</div>
<p style="text-indent: 0.5em;">
    <div id="play_btn">
        <table style="margin-left: auto;margin-right: auto;">
            <tr>
                <td>
                    <a href="{% url 'liar:game' gamer.game.gamecode gamer.user.username %}"><button type="button" class="btn btn-outline-info" style="height:25px;padding-top:initial;padding-bottom:initial;">ìƒˆë¡œê³ ì¹¨</button></a>
                    {% if gamer.game.ingameCd == 0 %}
                        {% if gamer.status != 1 %}
                    <button type="button" onclick="readygame()" class="btn btn-outline-info" style="height:25px;padding-top:initial;padding-bottom:initial;">ì°¸ê°€</button></a>
                        {% endif %}
                        {% if gamer.status != 2 %}
                    <button type="button" onclick="viewgame()" class="btn btn-outline-info" style="height:25px;padding-top:initial;padding-bottom:initial;">êµ¬ê²½</button></a>
                        {% endif %}
                    {% endif %}
                    {% if gamer.user.username == gamer.game.master.username %}
                        {% if gamer.game.ingameCd == 0 and not wait_gamers and ready_gamers|length > 3 %}
                    <button type="button" onclick="startgame()" class="btn btn-outline-primary" style="height:25px;padding-top:initial;padding-bottom:initial;">ê²Œì„ì‹œì‘</button></a>
                        {% elif gamer.game.ingameCd == 2 %}
                    <button type="button" onclick="votegame()" class="btn btn-outline-primary" style="height:25px;padding-top:initial;padding-bottom:initial;">íˆ¬í‘œ</button></a>
                        {% elif gamer.game.ingameCd == 3 %}
                    <button type="button" onclick="resultgame()" class="btn btn-outline-primary" style="height:25px;padding-top:initial;padding-bottom:initial;">ê²°ê³¼í™•ì¸</button></a>
                        {% elif gamer.game.ingameCd == 4 %}
                    <button type="button" onclick="endgame()" class="btn btn-outline-primary" style="height:25px;padding-top:initial;padding-bottom:initial;">ê²Œì„ì¢…ë£Œ</button></a>
                        {% endif %}
                    {% endif %}
                </td>
                <td class="tdh6" style="text-align:right;">
                {% if gamer.game.ingameCd == 0 %}
                    by <a href="{% url 'liar:telegram' gamer.game.gamecode gamer.user.username %}">{{ gamer.game.gamecode }}</a>
                {% else %}
                    Round : {{ gamer.game.round }} by {{ gamer.game.gamecode }}
                {% endif %}
                </td>
            </tr>
        </table>
    </div>
</p>
<div id="gamer_jobs">
    <table style="margin-left: auto;margin-right: auto;">
        <tbody>
            <tr>
                <td class="tdh6" scope="row" style="width: 10%;">
                    ì§ì—…
                </td>
                <td class="td6" scope="row">
                    <button type="button" onclick="descjob('citizen')" class="btn btn-outline-warning disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">ì‹œë¯¼</button>
                </td>
                <td class="td6" scope="row">
                    <button type="button" onclick="descjob('liar')" class="btn btn-outline-warning disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">ë¼ì´ì–´</button>
                </td>
                <td class="td6" scope="row">
                {% if gamer.game.tricksterYn %}
                    {% if gamer.game.ingameCd == 0 and gamer.user.username == gamer.game.master.username %}
                    <button type="button" onclick="trickster('{{ gamer.game.tricksterYn }}')" class="btn btn-outline-warning" style="height:20px;padding-top:initial;padding-bottom:initial;">ì‚¬ê¸°ê¾¼</button>
                    {% else %}
                    <button type="button" onclick="descjob('trickster')" class="btn btn-outline-warning disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">ì‚¬ê¸°ê¾¼</button>
                    {% endif %}
                {% elif gamer.game.ingameCd == 0 and gamer.user.username == gamer.game.master.username %}
                    <button type="button" onclick="trickster('{{ gamer.game.tricksterYn }}')" class="btn btn-outline-danger" style="height:20px;padding-top:initial;padding-bottom:initial;">ì‚¬ê¸°ê¾¼</button>
                {% endif %}
                </td>
                <td class="td6" scope="row">
                {% if gamer.game.whistleblowerYn %}
                    {% if gamer.game.ingameCd == 0 and gamer.user.username == gamer.game.master.username %}
                    <button type="button" onclick="whistleblower('{{ gamer.game.whistleblowerYn }}')" class="btn btn-outline-warning" style="height:20px;padding-top:initial;padding-bottom:initial;">ë‚´ë¶€ê³ ë°œì</button>
                    {% else %}
                    <button type="button" onclick="descjob('whistleblower')" class="btn btn-outline-warning disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">ë‚´ë¶€ê³ ë°œì</button>
                    {% endif %}
                {% elif gamer.game.ingameCd == 0 and gamer.user.username == gamer.game.master.username %}
                    <button type="button" onclick="whistleblower('{{ gamer.game.whistleblowerYn }}')" class="btn btn-outline-danger" style="height:20px;padding-top:initial;padding-bottom:initial;">ë‚´ë¶€ê³ ë°œì</button>
                {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% if wait_gamers %}
<div id="gamer_wait">
    <table style="margin-left: auto;margin-right: auto;">
        <tbody>
            <tr>
                <td class="tdh6" scope="row" style="width: 10%;">
                    ëŒ€ê¸°
                </td>
                <td class="td6" scope="row">
                    {% for wait_gamer in wait_gamers %}
                    <button type="button" class="btn btn-outline-dark disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">{{ wait_gamer.user.username }}</button>
                    {% endfor %}
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% endif %}
{% if view_gamers %}
<div id="gamer_view">
    <table style="margin-left: auto;margin-right: auto;">
        <tbody>
            <tr>
                <td class="tdh6" scope="row" style="width: 10%;">
                    ê´€ì „
                </td>
                <td class="td6" scope="row">
                    {% for view_gamer in view_gamers %}
                    <button type="button" class="btn btn-outline-secondary disabled" style="height:20px;padding-top:initial;padding-bottom:initial;">{{ view_gamer.user.username }}</button>
                    {% endfor %}
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% endif %}
{% if ready_gamers %}
<p style="text-indent: 0.5em;">
    <div id="player">
        <table style="margin-left: auto;margin-right: auto;">
            <thead>
                <tr>
                    <td class="tdh6c" scope="row">í”Œë ˆì´ì–´</td>
                    {% if gamer.game.ingameCd < 2 %}
                    <td class="tdh6c" scope="row">ìƒíƒœ</td>
                    {% endif %}
                    {% if gamer.game.ingameCd == 4 %}
                    <td class="tdh6c" scope="row">ì •ì²´</td>
                    {% endif %}
                    <td class="tdh6c" scope="row" style="width: 55%;">ì •ë³´</td>
                </tr>
            </thead>
            <tbody>
                {% for ready_gamer in ready_gamers %}
                <tr>
                    <td class="td6c" scope="row">{{ ready_gamer.user.username }}</td>
                {% if gamer.game.ingameCd < 2 %}
                    <td class="td6c" scope="row">
                    {% if gamer.game.ingameCd == 0 %}
                        ì°¸ê°€
                    {% elif gamer.game.ingameCd == 1 %}
                        {% if ready_gamer.categoryname %}
                        ì™„ë£Œ
                        {% else %}
                        ì„ íƒì¤‘
                        {% endif %}
                    {% endif %}
                    </td>
                {% endif %}
                    {% if gamer.game.ingameCd == 4 %}
                    <td class="td6c" scope="row">
                        {% if ready_gamer.job == 'citizen' %}
                        ì‹œë¯¼
                        {% elif ready_gamer.job == 'liar' %}
                        <b style='color:red !important;'>ë¼ì´ì–´</b>
                        {% elif ready_gamer.job == 'trickster' %}
                        <b style='color:orange !important;'>ì‚¬ê¸°ê¾¼</b>
                        {% elif ready_gamer.job == 'whistleblower' %}
                        <b style='color:blue !important;'>ë‚´ë¶€ê³ ë°œì</b>
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if forloop.counter == 1 %}
                        {% if gamer.status == 1 %}
                            {% if gamer.game.ingameCd == 1 %}
                    <td class="td6c" scope="row" style="width: 50%;" rowspan="{{ ready_gamers|length }}">
                                {% if gamer.categoryname %}
                                    {% for player_category in player_categories %}
                        {{ player_category.0 }} : {{ player_category.1 }}<br>
                                    {% endfor %}
                                {% else %}
                                    {% for category in categories %}
                        <button type="button" onclick="gamecategory('{{ category.categoryname }}')" class="btn btn-outline-success" style="height:25px;padding-top:initial;padding-bottom:initial;">{{ category.categoryname }}</button>
                                    {% endfor %}
                                {% endif %}
                    </td>
                            {% elif gamer.game.ingameCd == 2 or gamer.game.ingameCd == 3 %}
                    <td class="td6" scope="row" style="width: 50%;" rowspan="{{ ready_gamers|length }}">
                                {% if gamer.job == 'liar' %}
                        I am a Liar~ğŸ‘»<br><br>ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}
                                {% elif gamer.job == 'citizen' %}
                        ë‚˜ ì§„ì§œ ì‹œë¯¼ì´ë¼ê³ ~â˜ <br><br>ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}<br>ì œì‹œì–´: {{ gamer.game.word }}
                                {% elif gamer.job == 'trickster' %}
                        ë‚˜ëŠ” ë‚˜ëŠ” ì‚¬ê¸°ê¾¼~ğŸ¶<br><br>ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}<br>ì œì‹œì–´: {{ gamer.game.word }}
                                {% elif gamer.job == 'whistleblower' %}
                        ë¼ì´ì–´ê°€ ëˆ„êµ¬ëƒë©´? ì‰¿~ğŸ¤«<br><br>ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}<br>ì œì‹œì–´: {{ gamer.game.word }}<br>ë¼ì´ì–´: {{ liar.user.username }}
                                {% endif %}
                    </td>
                            {% elif gamer.game.ingameCd == 4 %}
                    <td class="td6c" scope="row" style="width: 50%;" rowspan="{{ ready_gamers|length }}">
                        ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}<br>ì œì‹œì–´: {{ gamer.game.word }}
                    </td>
                            {% endif %}
                        {% elif gamer.status == 2 %}
                            {% if gamer.game.ingameCd == 1 %}
                    <td class="td6c" scope="row" style="width: 50%;" rowspan="{{ ready_gamers|length }}">
                                {% for player_category in player_categories %}
                        {{ player_category.0 }} : {{ player_category.1 }}<br>
                                {% endfor %}
                    </td>
                            {% elif gamer.game.ingameCd == 2 or gamer.game.ingameCd == 3 or gamer.game.ingameCd == 4 %}
                    <td class="td6c" scope="row" style="width: 50%;" rowspan="{{ ready_gamers|length }}">
                        ì¹´í…Œê³ ë¦¬: {{ gamer.game.categoryname }}<br>ì œì‹œì–´: {{ gamer.game.word }}
                    </td>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</p>
{% endif %}
</body>
</html>